Version: "0.1"
Environment:
  Name: nmmo
  Description: An NMMO-type game. The idea is to set up an open-ended system wherein agents can progress from hunter gathering, to agriculture, to basic civilization.
  Observers:
    Sprite2D:
      TileSize: 16
      BackgroundTile: oryx/oryx_tiny_galaxy/tg_sliced/tg_world/tg_world_floor_panel_metal_a.png
    Isometric:
      TileSize: [32, 48]
      BackgroundTile: oryx/oryx_iso_dungeon/grass-1.png
      TileOffsetY: 16
  Variables:
    - Name: player_resources
      InitialValue: 0
    - Name: player_dead
      InitialValue: 0
  Player:
    Count: 50
    Observer:
      RotateWithAvatar: true
      TrackAvatar: true
      Height: 7
      Width: 7
      OffsetX: 0
      OffsetY: 0
    AvatarObject: gnome
  Termination:
    Lose:
      #FIXME: This is broken, probably because gnomes are also player avatars.
#     - eq: [gnome:count, 0] # If all the gnomes are dead
    Win:
#     - eq: [_score, 10] # First player to 10 reward points

  Levels: # An initial placeholder level will be added at runtime using python.

Actions:
# - Name: spawn_gnome
#   InputMapping:
#     Internal: true
#   Behaviours:
#     - Src:
#         Object: base
#         Commands:
#           - spawn: gnome
#       Dst:
#         Object: _empty

#     - Src:
#         Object: base
#       Dst:
#         Object: [base, puncher, gnome, pusher, movable_wall]
#         Commands:
#           - exec:
#               Action: spawn_gnome
#               Delay: 1
#               Randomize: true

# # Harvester costs 5 resources to build
# - Name: build_gnome
#   Behaviours:
#     - Src:
#         Preconditions:
#           - gt: [player_resources, 5]
#         Object: base
#       Dst:
#         Object: base
#         Commands:
#           - exec:
#               Action: spawn_gnome
#               Delay: 10
#               Randomize: true


  - Name: gather
    Behaviours:
      # gnomes can gather shrubs
      - Src:
          Object: gnome
          Commands:
            - incr: leaves
            - reward: 1
        Dst:
          Object: shrubs
          Commands:
            - decr: leaves
            - eq:
                Arguments: [leaves, 0]
                Commands:
                  - remove: true

#     # gnomes can gather minerals
#     - Src:
#         Object: gnome
#         Commands:
#           - incr: resources
#           - reward: 1
#       Dst:
#         Object: minerals
#         Commands:
#           - decr: resources
#           - eq:
#               Arguments: [resources, 0]
#               Commands:
#                 - remove: true
#     - Src:
#         Object: gnome
#         Commands:
#           - decr: resources
#           - reward: 1
#       Dst:
#         Object: base
#         Commands:
#           - incr: player_resources

  - Name: move
    Behaviours:
      # gnomes will disintegrate in lava
      - Src:
          Object: gnome
          Commands:
            - reward: -1
            - remove: true
            - mov: _dest
            - set_tile: 1
        Dst:
          Object: lava
          Commands:
            - set_tile: 1
         #  - remove: true

      # movable objects can move into empty spaces and lava
      - Src:
          Object: gnome
          Commands:
            - mov: _dest # mov will move the object, _dest is the destination location of the action
        Dst:
          Object: _empty

      # pushers can push objects
#     - Src:
#         Object: pusher
#         Commands:
#           - mov: _dest # mov will move the object, _dest is the destination location of the action
#       Dst:
#         Object: [movable_wall, gnome, puncher]
#         Commands:
#           - cascade: _dest # reapply the same action to the dest location of the action

# - Name: punch
#   Behaviours:
#     - Src:
#         Object: puncher
#         Commands:
#           - reward: 1
#       Dst:
#         Object: [puncher, gnome, pusher, base]
#         Commands:
#           - decr: health
#           - eq:
#               Arguments: [0, health]
#               Commands:
#                 - remove: true

Objects:
  - Name: shrubs
    MapCharacter: S
    Variables:
      - Name: leaves
        InitialValue: 1
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/bush-1.png

  - Name: rock
    MapCharacter: R
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/wall-grey-1.png
       #- Image: rock-1.png
          Offset: [0, 15]

# - Name: minerals
#   MapCharacter: M
#   Variables:
#     - Name: resources
#       InitialValue: 200
#   Observers:
#     Sprite2D:
#       - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_items/tg_items_crystal_green.png
#     Block2D:
#       - Shape: triangle
#         Color: [0.0, 1.0, 0.0]
#         Scale: 1.0
#     Isometric:
#       - Image: oryx/oryx_iso_dungeon/minerals-1.png

  - Name: gnome
    MapCharacter: H
    Variables:
      - Name: leaves
        InitialValue: 0
      - Name: resources
        InitialValue: 0
      - Name: health
        InitialValue: 10
    Observers:
      Sprite2D:
        - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_monsters/tg_monsters_jelly_d1.png
      Block2D:
        - Shape: square
          Color: [0.6, 0.2, 0.2]
          Scale: 0.5
      Isometric:
        - Image: oryx/oryx_iso_dungeon/avatars/gnome-1.png
        - Image: oryx/oryx_iso_dungeon/lava-1.png
        # if a gnome dies in lava, they "become" the lava. Note that other gnomes cannot die here anymore.
        # TODO: tile with gnome floating in lava.

# - Name: pusher
#   MapCharacter: P
#   Variables:
#     - Name: health
#       InitialValue: 10
#   Observers:
#     Sprite2D:
#       - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_monsters/tg_monsters_crawler_queen_d1.png
#     Block2D:
#       - Shape: square
#         Color: [0.2, 0.2, 0.6]
#         Scale: 1.0
#     Isometric:
#       - Image: oryx/oryx_iso_dungeon/queen-1.png

# - Name: puncher
#   MapCharacter: p
#   Variables:
#     - Name: health
#       InitialValue: 5
#   Observers:
#     Sprite2D:
#       - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_monsters/tg_monsters_beast_d1.png
#     Block2D:
#       - Color: [0.2, 0.6, 0.6]
#         Shape: square
#         Scale: 0.8
#     Isometric:
#       - Image: oryx/oryx_iso_dungeon/beast-1.png

  - Name: lava
    MapCharacter: W
    Observers:
      Sprite2D:
        - TilingMode: WALL_2 # Will tile walls with two images
          Image:
            - oryx/oryx_tiny_galaxy/tg_sliced/tg_world_fixed/img33.png
            - oryx/oryx_tiny_galaxy/tg_sliced/tg_world_fixed/img40.png
      Block2D:
        - Color: [0.5, 0.5, 0.5]
          Shape: square
      Isometric:
        - Image: oryx/oryx_iso_dungeon/lava-1.png
          Offset: [0, 4]
        - Image: oryx/oryx_iso_dungeon/lava-1.png
          Offset: [0, 2]

# - Name: movable_wall
#   MapCharacter: w
#   Observers:
#     Sprite2D:
#       - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_world_fixed/img282.png
#     Block2D:
#       - Color: [0.8, 0.8, 0.8]
#         Shape: square
#     Isometric:
#       - Image: oryx/oryx_iso_dungeon/crate-1.png

# - Name: base
#   MapCharacter: B
#   Variables:
#     - Name: health
#       InitialValue: 10
#   Observers:
#     Sprite2D:
#       - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_world_fixed/img324.png
#     Block2D:
#       - Color: [0.8, 0.8, 0.3]
#         Shape: triangle
#     Isometric:
#       - Image: oryx/oryx_iso_dungeon/base-1.png
