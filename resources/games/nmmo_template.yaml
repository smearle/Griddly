Version: "0.1"
Environment:
  Name: nmmo
  Description: An NMMO-type game. The idea is to set up an open-ended system wherein agents can progress from hunter gathering, to agriculture, to basic civilization.
  Observers:
    Sprite2D:
      TileSize: 16
      BackgroundTile: oryx/oryx_tiny_galaxy/tg_sliced/tg_world/tg_world_floor_panel_metal_a.png
    Isometric:
      TileSize: [32, 48]
      BackgroundTile: oryx/oryx_iso_dungeon/grass-1.png
      TileOffsetY: 16
  Variables:
    - Name: player_resources
      InitialValue: 0
    - Name: player_dead
      InitialValue: 0
  Player:
    Count: 10
    Observer:
      RotateWithAvatar: true
      TrackAvatar: true
      Height: 7
      Width: 7
      OffsetX: 0
      OffsetY: 0
    AvatarObject: gnome
  Termination:
    Lose:
      #FIXME: This is broken, probably because gnomes are also player avatars.
#     - eq: [gnome:count, 0] # If all the gnomes are dead
    Win:
#     - eq: [_score, 10] # First player to 10 reward points

  Levels: # An initial placeholder level will be added at runtime using python.

Actions:
  - Name: tick_hunger
    InputMapping:
      Inputs:
        1:
          Description: Tick self
          OrientationVector: [0, 0]
      Relative: true
      Internal: true
    Behaviours:
      - Src:
          Object: gnome
          Commands:
#           - gt:
#               Arguments: [leaves, 0]
#               Commands:
#                 - remove: true
#                 - decr: health
            - eq:
                Arguments: [health, 0]
                Commands:
                 #- exec:
                 #  # If hunger is depleted, begin to decrement health
                 #  Delay: ${_delay}
                 #  Src
                  - remove: true
            - exec:
                # At next game tick, repeat.
                Delay: ${_delay} # scale this dynamically to match number of players (temporary hack)
                Action: tick_hunger
        Dst:
            Object: gnome

  - Name: gather
    Behaviours:
      # gnomes can gather shrubs
      - Src:
          Object: gnome
          Commands:
            - incr: leaves
         #  - incr: health
            - reward: 1
        Dst:
          Object: shrubs
          Commands:
            - decr: leaves
            - eq:
                Arguments: [leaves, 0]
                Commands:
                  - remove: true

  - Name: move
    Behaviours:
      # gnomes will disintegrate in lava
      - Src:
          Object: gnome
          Commands:
            - reward: -1
            - remove: true
            - mov: _dest
            - set_tile: 1
        Dst:
          Object: lava
          Commands:
            - set_tile: 1 # the lave rises a bit

      # gnomes can move into empty spaces
      - Src:
          Object: gnome
          Commands:
            - mov: _dest # mov will move the object, _dest is the destination location of the action
        Dst:
          Object: _empty

Objects:
  - Name: shrubs
    MapCharacter: S
    Variables:
      - Name: leaves
        InitialValue: 2
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/bush-1.png

  - Name: water
    MapCharacter: W
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/water-1.png
          Offset: [0, 4]

  - Name: rock
    MapCharacter: R
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/wall-grey-1.png
          Offset: [0, 15]

  - Name: lava
    MapCharacter: L
    Observers:
      Isometric:
        - Image: oryx/oryx_iso_dungeon/lava-1.png
          Offset: [0, 4]
        - Image: oryx/oryx_iso_dungeon/lava-1.png
          Offset: [0, 2]

  - Name: gnome
    InitialActions:
      # Start ticking hunger after an initial grace period.
      - Action: tick_hunger
        Delay: ${_init_delay}
    MapCharacter: H
    Variables:
      - Name: leaves
        InitialValue: 0
      - Name: resources
        InitialValue: 0
      - Name: health
        InitialValue: 10
    Observers:
      Sprite2D:
        - Image: oryx/oryx_tiny_galaxy/tg_sliced/tg_monsters/tg_monsters_jelly_d1.png
      Block2D:
        - Shape: square
          Color: [0.6, 0.2, 0.2]
          Scale: 0.5
      Isometric:
        - Image: oryx/oryx_iso_dungeon/avatars/gnome-1.png
